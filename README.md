# KyoshinShindoPlaceEditor

強震モニタの色を取得するピクセル座標を変換・編集するアプリケーションです。

## 本体のソースコードを読む前に
このアプリケーションは目的のために開発されたため、可読性を大きく失っています。読む際は心して読んで下さい。

## ビルドに必要なもの
- .NET Framework 4.6.2
- VisualStudio 2017(それ以外では未確認)

## チュートリアル
左上の強震モニタの画像操作については強震モニタ画像右上の`?`ボタンまたは下記を参照してください。  
このチュートリアルではとりあえずNIEDの観測点情報のCSVデータからベースを生成し、EqWatchのデータをインポートするところまでを解説します。  
挙動がおかしい場合や、動作を停止した場合は下記のFAQを参考にしてください。  

1. とりあえず起動します。右リストには何も無いはずです。
1. まずはNIEDのデータをインポートしてみましょう。 [NIEDのページ](http://www.kyoshin.bosai.go.jp/kyoshin/db/index.html?all)の上部にある、`観測点一覧(CSVファイル)は、こちら（ K-NET&KiK-net、K-NET、 KiK-net）をクリックしてダウンロードできます。`の、`K-NET`、`KiK-net`を個別にダウンロードし、 **このアプリケーションのディレクトリ** に配置します。
1. 右上のメニューから`インポート`→`NIEDの観測点情報`をクリックしてください。ファイルが存在しない場合はエラーが表示されます。ここで失敗する場合は、バグもしくは不正なファイルを読み込ませている可能性があります。もう一度確認してください。
1. 正常にインポートされていることが確認できたら、次はEqWatchのデータをインポートしてみましょう。
1. まず、`EqWatch.exe`と同じディレクトリにある`Kansokuten.dat`を **このアプリケーションのディレクトリ** に **コピー** してください。(このあと編集するためです)
1. **コピー先のファイルを** 適当なテキストエディタで開いたあと、すべての`烏海`を`鳥海`に置き換えてください。(余談:烏海市は中国の都市)
1. 保存したあと、右上の`インポート`→`EqWatch`をクリックしてください。
1. うまく行けば追加は0件になるはずですが、情報が更新などされていた場合はその限りではありません。
1. 編集しやすいように観測点コード順にソートしてみましょう。メニューの`観測点コード順に並び替える`をクリックします。
1. ズレがある場所がないか左上のマップをチェックして、(右のリストの項目を選択すると左下のマップに赤点が表示されるので場所確認に便利です。マップは右ドラッグで移動できます。)適度修正してください。(特に沖縄周辺)

- **保存ボタンを押さないと保存されません。** 終了する前には必ず保存するようにしておきましょう。保存・読み込みは上メニューの`ファイル(F)`内にあります。

### 注意
EqWatchのデータには観測点コード存在しません。  
そのため、EqWatchにしかなく、インポートする際に追加されたデータのコードは`_EQW番号`となります。  
そのため、NIEDのデータの前にEqWatchのデータをインポートしてしまうと、コードが違うため、同じ地点であるはずの観測点が増えることになります。

## 左上下の画像操作方法
- 上の強震モニタの画像、下の地図ともに右クリックを押したまま移動で移動することができます。
- 手抜きなのでどこまでも移動できてしまいますが、スクロール判定は画像内だけなのでくれぐれもウィンドウ外に出さないようにしてください。
- 右のリストの項目を選択すると、下の地図にその項目の座標の赤点が表示されます。
- 右のリストの項目を選択している状態で上の強震モニタの画像を左クリックすると参照地点を移動することができます。
- 強震モニタの画像の参照地点(赤またはオレンジ色になっている地点)を中ボタン(ホイールボタン)クリックするとその座標に参照指定されてる項目が選択されます。微修正などに活用してください。

## ファイル形式の違い
### MessagePack(非圧縮)
ProtocolBuffersに比べてファイルサイズが小さい上、読み書きが非常に高速です。

### MessagePack(LZ4圧縮)
上記のMessagePackに高速なLZ4圧縮を加えるのでさらにファイルサイズが小さくなります。

### Protocol Buffers(pbf)
ファイルサイズが小さくなります。読み込みが非常に高速です。(まだないけど).protoファイルがあれば様々な言語で簡単に利用することができます。

### json
ファイルサイズが大きくなりますがJavascriptから利用する場合、簡単に読み込むことができます。

### csv
文字ベースになるためファイルサイズが少し大きくなりますが、どのアプリケーションでも簡単に処理することができます。

## 保存したファイルの使用方法
pbf形式にて保存したファイルを読み込む際には`ReadDataExample`を参照してください。  
`Program.cs`に重要なことは大体書いてあります。(.protoかけてなくてスミマセン！)

csv形式で保存したファイルの出力形式は、  
`所属しているネットワークの種類(0=不明,1=KiK-net,2=K-NET),地点コード,休止(無効)状態にあるかどうか(True/False),観測地点名,観測地点が属する地域の名称,緯度,経度,強震モニタ上でのX座標,強震モニタ上でのY座標`  
となっています。強震モニタ上での座標がない場合、X,Y共に空になります。手動微調整する用に作っています。

## ライセンス
下にそれとなく書いてありますが、明記しておきます。

あまりにもひどいソースコードが氾濫するのを防ぐため、`KyoshinShindoPlaceEditor`に関しては引用などは原則禁止とさせていただきます。  
どうしても使いたい場合があれば連絡していただければ限定的に許可する場合もあります。

## 利用について
このアプリケーションで作成したファイルをアプリケーションに使用する際はできるだけ(個人でしか利用しないとしても報告していただければ喜びます)作者(ingen084)に報告してください。  
`ヘルプ(H)`→`このアプリケーションについて(A)`に連絡先がたくさん載っています。クレジット表記は任意です。

公開するアプリケーションにこのアプリケーションを添付して配布(再配布)などは要相談でお願いします。(まだアップデートチェックなどは実装していないので。)  
というか、KyoshinShindoPlaceEditorのソースの方はあまりにもクソすぎるので使わないほうがいいです。マジで(マジで)

## 利用方法
KyoshinMonitorLibを使用してください。

## 設定
`KyoshinShindoPlaceEditor.exe.config`を編集します。
```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="KyoshinShindoPlaceEditor.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false" />
        </sectionGroup>
    </configSections>
    <startup> 
        <supportedRuntime version="v4.0" sku=".NETFramework,Version=v4.6.2" />
    </startup>
    <applicationSettings>
        <KyoshinShindoPlaceEditor.Properties.Settings>
            <setting name="AutoLoadFilePath" serializeAs="String">
                <value>[起動時に読み込むファイルのパス]</value>
            </setting>
        </KyoshinShindoPlaceEditor.Properties.Settings>
    </applicationSettings>
</configuration>
```
ここの`[起動時に読み込むファイルのパス]`を編集することで、起動時に自動で読み込まれるファイルを変更することができます。  
絶対・相対パス共に利用できますので、是非活用してください。

## FAQ
### 使い方わかんねぇ
この通りガバガバ解説なのでなんでも聞いてください。  
(問い合わせ先は`ヘルプ(H)`→`このアプリケーションについて(A)`を参照)

### 落ちた
結構エラー処理適当なので
状況を教えてくれるかデバッグしてくれると助かります。

### なんやこのクソース アホくさ。辞めたらこの仕事?
わかる

## 注意事項
このアプリケーションを使用したことによる損害などについて作者は責任を負えないこととします。  
EqWatchのデータをインポートした場合、該当するデータはEqWatch作者様の指示に従ってください。